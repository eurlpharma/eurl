import{F as he,G as pe,N as ue,r as x,j as e,C as xe,T as m,U as t,a2 as Z,ar as we,a1 as fe,B as J,ai as je,P as l,Z as G,aj as L,I as y,as as be,at as Pe}from"./index-d1e9d783.js";import{c as M,a as n,b as ge,u as O,o as V}from"./index.esm-590aa197.js";import{u as ye}from"./useNotification-a88ee381.js";import{T as Ne,a as _}from"./Tabs-b6eb77ed.js";import{I as N}from"./InputAdornment-06a64392.js";import{E as v}from"./EyeSlashIcon-80eca774.js";import{E as S}from"./EyeIcon-1bf2a3b0.js";import"./KeyboardArrowRight-68c72fff.js";const H=s=>{const{children:w,value:u,index:h,...r}=s;return e.jsx("div",{role:"tabpanel",hidden:u!==h,id:`profile-tabpanel-${h}`,"aria-labelledby":`profile-tab-${h}`,...r,children:u===h&&e.jsx(J,{className:"pt-4",children:w})})},Ae=()=>{var q,E,I,W,A,$,U,z,B,D,k,F,R;const{t:s}=he(),w=pe(),{success:u,error:h}=ye(),{user:r,loading:i,error:C}=ue(a=>a.auth),[P,K]=x.useState(0),[f,Q]=x.useState(!1),[j,X]=x.useState(!1),[b,Y]=x.useState(!1),ee=M().shape({firstName:n().required(s("validation.required")),lastName:n().required(s("validation.required")),email:n().email(s("validation.invalidEmail")).required(s("validation.required")),phone:n(),address:n(),city:n(),postalCode:n(),country:n()}),se=M().shape({currentPassword:n().required(s("validation.required")),newPassword:n().required(s("validation.required")).min(8,s("validation.passwordLength")).matches(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]/,s("validation.passwordRequirements")),confirmPassword:n().oneOf([ge("newPassword")],s("validation.passwordsMatch")).required(s("validation.required"))}),{register:d,handleSubmit:re,formState:{errors:o},reset:T}=O({resolver:V(ee),defaultValues:{firstName:((q=r==null?void 0:r.name)==null?void 0:q.split(" ")[0])||"",lastName:((E=r==null?void 0:r.name)==null?void 0:E.split(" ")[1])||"",email:(r==null?void 0:r.email)||""}}),{register:g,handleSubmit:ae,formState:{errors:p},reset:te}=O({resolver:V(se)});x.useEffect(()=>{var a;if(r){const c=((a=r.name)==null?void 0:a.split(" "))||["",""];T({firstName:c[0]||"",lastName:c.slice(1).join(" ")||"",email:r.email||"",phone:r.phone||"",address:r.address||"",city:r.city||"",postalCode:r.postalCode||"",country:r.country||""})}},[r,T]);const ie=(a,c)=>{K(c)},oe=async a=>{try{const c={name:`${a.firstName} ${a.lastName}`.trim(),email:a.email,phone:a.phone,address:a.address,city:a.city,postalCode:a.postalCode,country:a.country};await w(be(c)).unwrap(),u(s("profile.updateSuccess"))}catch{h(s("profile.updateError"))}},le=async a=>{try{await w(Pe({currentPassword:a.currentPassword,newPassword:a.newPassword})).unwrap(),u(s("profile.passwordUpdateSuccess")),te()}catch{h(s("profile.passwordUpdateError"))}},ne=()=>{Q(!f)},de=()=>{X(!j)},ce=()=>{Y(!b)},me=()=>{if(!r||!r.name)return"?";const a=r.name.split(" ");return a.length>=2?`${a[0][0]}${a[1][0]}`.toUpperCase():a[0][0].toUpperCase()};return e.jsxs(xe,{maxWidth:"lg",className:"py-8",children:[e.jsx(m,{variant:"h4",component:"h1",className:"mb-6 font-bold",children:s("profile.title")}),e.jsxs(t,{container:!0,spacing:4,children:[e.jsx(t,{item:!0,xs:12,md:4,lg:3,children:e.jsxs(Z,{className:"p-6 text-center",children:[e.jsx(we,{className:"mx-auto mb-4 bg-primary-600 text-white",sx:{width:80,height:80,fontSize:32},children:me()}),e.jsx(m,{variant:"h6",className:"font-bold",children:r==null?void 0:r.name}),e.jsx(m,{variant:"body2",className:"text-gray-600 mb-4",children:r==null?void 0:r.email}),e.jsx(fe,{className:"my-4"}),e.jsxs(J,{className:"text-left",children:[e.jsxs(m,{variant:"subtitle2",className:"mb-1",children:[s("profile.accountType"),":"]}),e.jsx(m,{variant:"body2",className:"mb-3",children:(r==null?void 0:r.role)==="admin"?s("profile.admin"):s("profile.customer")}),e.jsxs(m,{variant:"subtitle2",className:"mb-1",children:[s("profile.memberSince"),":"]}),e.jsx(m,{variant:"body2",children:r!=null&&r.createdAt?new Date(r.createdAt).toLocaleDateString():"-"})]})]})}),e.jsx(t,{item:!0,xs:12,md:8,lg:9,children:e.jsxs(Z,{className:"p-6",children:[e.jsxs(Ne,{value:P,onChange:ie,variant:"scrollable",scrollButtons:"auto",className:"mb-4",children:[e.jsx(_,{label:s("profile.personalInfo")}),e.jsx(_,{label:s("profile.security")})]}),C&&e.jsx(je,{severity:"error",className:"mb-4",children:C}),e.jsx(H,{value:P,index:0,children:e.jsx("form",{onSubmit:re(oe),children:e.jsxs(t,{container:!0,spacing:3,children:[e.jsx(t,{item:!0,xs:12,sm:6,children:e.jsx(l,{label:s("auth.firstName"),fullWidth:!0,...d("firstName"),error:!!o.firstName,helperText:(I=o.firstName)==null?void 0:I.message,disabled:i})}),e.jsx(t,{item:!0,xs:12,sm:6,children:e.jsx(l,{label:s("auth.lastName"),fullWidth:!0,...d("lastName"),error:!!o.lastName,helperText:(W=o.lastName)==null?void 0:W.message,disabled:i})}),e.jsx(t,{item:!0,xs:12,children:e.jsx(l,{label:s("auth.email"),type:"email",fullWidth:!0,...d("email"),error:!!o.email,helperText:(A=o.email)==null?void 0:A.message,disabled:i})}),e.jsx(t,{item:!0,xs:12,children:e.jsx(l,{label:s("profile.phone"),fullWidth:!0,...d("phone"),error:!!o.phone,helperText:($=o.phone)==null?void 0:$.message,disabled:i})}),e.jsx(t,{item:!0,xs:12,children:e.jsx(l,{label:s("profile.address"),fullWidth:!0,...d("address"),error:!!o.address,helperText:(U=o.address)==null?void 0:U.message,disabled:i})}),e.jsx(t,{item:!0,xs:12,sm:6,children:e.jsx(l,{label:s("profile.city"),fullWidth:!0,...d("city"),error:!!o.city,helperText:(z=o.city)==null?void 0:z.message,disabled:i})}),e.jsx(t,{item:!0,xs:12,sm:6,children:e.jsx(l,{label:s("profile.postalCode"),fullWidth:!0,...d("postalCode"),error:!!o.postalCode,helperText:(B=o.postalCode)==null?void 0:B.message,disabled:i})}),e.jsx(t,{item:!0,xs:12,children:e.jsx(l,{label:s("profile.country"),fullWidth:!0,...d("country"),error:!!o.country,helperText:(D=o.country)==null?void 0:D.message,disabled:i})}),e.jsx(t,{item:!0,xs:12,children:e.jsx(G,{type:"submit",variant:"contained",color:"primary",disabled:i,startIcon:i&&e.jsx(L,{size:20,color:"inherit"}),children:s(i?"common.saving":"profile.saveChanges")})})]})})}),e.jsx(H,{value:P,index:1,children:e.jsx("form",{onSubmit:ae(le),children:e.jsxs(t,{container:!0,spacing:3,children:[e.jsx(t,{item:!0,xs:12,children:e.jsx(l,{label:s("profile.currentPassword"),type:f?"text":"password",fullWidth:!0,...g("currentPassword"),error:!!p.currentPassword,helperText:(k=p.currentPassword)==null?void 0:k.message,disabled:i,InputProps:{endAdornment:e.jsx(N,{position:"end",children:e.jsx(y,{onClick:ne,edge:"end","aria-label":f?"hide password":"show password",children:f?e.jsx(v,{className:"w-5 h-5"}):e.jsx(S,{className:"w-5 h-5"})})})}})}),e.jsx(t,{item:!0,xs:12,children:e.jsx(l,{label:s("profile.newPassword"),type:j?"text":"password",fullWidth:!0,...g("newPassword"),error:!!p.newPassword,helperText:(F=p.newPassword)==null?void 0:F.message,disabled:i,InputProps:{endAdornment:e.jsx(N,{position:"end",children:e.jsx(y,{onClick:de,edge:"end","aria-label":j?"hide password":"show password",children:j?e.jsx(v,{className:"w-5 h-5"}):e.jsx(S,{className:"w-5 h-5"})})})}})}),e.jsx(t,{item:!0,xs:12,children:e.jsx(l,{label:s("profile.confirmNewPassword"),type:b?"text":"password",fullWidth:!0,...g("confirmPassword"),error:!!p.confirmPassword,helperText:(R=p.confirmPassword)==null?void 0:R.message,disabled:i,InputProps:{endAdornment:e.jsx(N,{position:"end",children:e.jsx(y,{onClick:ce,edge:"end","aria-label":b?"hide password":"show password",children:b?e.jsx(v,{className:"w-5 h-5"}):e.jsx(S,{className:"w-5 h-5"})})})}})}),e.jsxs(t,{item:!0,xs:12,children:[e.jsx(m,{variant:"caption",className:"text-gray-600 mb-4 block",children:s("profile.passwordRequirements")}),e.jsx(G,{type:"submit",variant:"contained",color:"primary",disabled:i,startIcon:i&&e.jsx(L,{size:20,color:"inherit"}),children:s(i?"common.saving":"profile.updatePassword")})]})]})})})]})})]})]})};export{Ae as default};
