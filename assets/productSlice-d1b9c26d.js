import{bj as c,bk as u,bl as I}from"./index-d1e9d783.js";const j="/api",D={products:[],product:null,featuredProducts:[],loading:!1,error:null,totalProducts:0,uploadStatus:{loading:!1,error:null,success:!1},currentProduct:null},g=c("products/getProducts",async(t={},{rejectWithValue:e})=>{var a,d;try{const{keyword:r="",page:o=1,limit:s=10,sortBy:w="createdAt",category:F="",minPrice:n,maxPrice:p}=t;let l=`/api/products?page=${o}&limit=${s}`;r&&(l+=`&keyword=${encodeURIComponent(r)}`),F&&(l+=`&category=${F}`),n!==void 0&&n>0&&(l+=`&minPrice=${n}`),p!==void 0&&p>0&&(l+=`&maxPrice=${p}`),w!=="createdAt"&&(l+=`&sortBy=${w}`);const i=await u.get(l);return{products:i.data.products,totalProducts:i.data.totalProducts,maxPrice:i.data.maxPrice}}catch(r){const o=((d=(a=r.response)==null?void 0:a.data)==null?void 0:d.message)||r.message||"Failed to fetch products";return e(o)}}),f=c("products/getFeaturedProducts",async(t=8,{rejectWithValue:e})=>{var a,d;try{return(await u.get(`/api/products/featured?count=${t}`)).data}catch(r){const o=((d=(a=r.response)==null?void 0:a.data)==null?void 0:d.message)||r.message||"Failed to fetch featured products";return e(o)}}),m=c("products/getProductDetails",async(t,{rejectWithValue:e})=>{var a,d;try{const r=await u.get(`/api/products/${t}`);return r.data&&r.data.success&&r.data.product?r.data.product:r.data?r.data:e("Invalid response structure from server")}catch(r){const o=((d=(a=r.response)==null?void 0:a.data)==null?void 0:d.message)||r.message||"Failed to fetch product details";return e(o)}}),y=c("products/createProduct",async(t,{rejectWithValue:e})=>{var a,d;try{const r=localStorage.getItem("token");return(await u.post("/api/products",t,{headers:{Authorization:`Bearer ${r}`}})).data}catch(r){const o=((d=(a=r.response)==null?void 0:a.data)==null?void 0:d.message)||r.message||"Failed to create product";return e(o)}}),P=c("products/createProductTextData",async(t,{rejectWithValue:e})=>{var a,d;try{return(await u.post("/api/products",t,{headers:{"Content-Type":"application/json"}})).data}catch(r){const o=((d=(a=r.response)==null?void 0:a.data)==null?void 0:d.message)||r.message||"Failed to create product";return e(o)}}),C=c("products/updateProduct",async({id:t,productData:e},{rejectWithValue:a})=>{var d,r;try{return(await u.put(`${j}/products/${t}`,e,{headers:{"Content-Type":"multipart/form-data"}})).data}catch(o){return a(((r=(d=o.response)==null?void 0:d.data)==null?void 0:r.message)||"Failed to update product")}}),h=c("products/deleteProduct",async(t,{rejectWithValue:e})=>{var a,d;try{await u.delete(`/api/products/${t}`);try{await u.delete(`/api/upload/product/${t}`)}catch{}return t}catch(r){const o=((d=(a=r.response)==null?void 0:a.data)==null?void 0:d.message)||r.message||"Failed to delete product";return e(o)}}),S=c("products/uploadProductImage",async({productId:t,image:e},{rejectWithValue:a})=>{var d,r;try{const o=new FormData;return o.append("image",e),t&&o.append("productId",t),(await u.post("/api/upload/image",o,{headers:{"Content-Type":"multipart/form-data"}})).data}catch(o){const s=((r=(d=o.response)==null?void 0:d.data)==null?void 0:r.message)||o.message||"Failed to upload image";return a(s)}}),$=c("products/uploadProductImages",async(t,{rejectWithValue:e})=>{var a,d;try{const r=new FormData;return t.forEach(s=>{r.append("images",s)}),(await u.post("/api/upload/product-images",r,{headers:{"Content-Type":"multipart/form-data"}})).data}catch(r){const o=((d=(a=r.response)==null?void 0:a.data)==null?void 0:d.message)||r.message||"Failed to upload product images";return e(o)}}),x=I({name:"products",initialState:D,reducers:{resetProductDetails:t=>{t.product=null,t.currentProduct=null,t.error=null},clearProductErrors:t=>{t.error=null,t.uploadStatus.error=null}},extraReducers:t=>{t.addCase(g.pending,e=>{e.loading=!0,e.error=null}).addCase(g.fulfilled,(e,a)=>{e.loading=!1,a.payload&&a.payload.products&&(e.products=a.payload.products,e.totalProducts=a.payload.totalProducts)}).addCase(g.rejected,(e,a)=>{e.loading=!1,e.error=a.payload}).addCase(f.pending,e=>{e.loading=!0,e.error=null}).addCase(f.fulfilled,(e,a)=>{e.loading=a.payload.success,e.featuredProducts=a.payload.products}).addCase(f.rejected,(e,a)=>{e.loading=!1,e.error=a.payload}).addCase(m.pending,e=>{e.loading=!0,e.error=null}).addCase(m.fulfilled,(e,a)=>{e.loading=!1,e.product=a.payload}).addCase(m.rejected,(e,a)=>{e.loading=!1,e.error=a.payload}).addCase(y.pending,e=>{e.loading=!0,e.error=null}).addCase(y.fulfilled,(e,a)=>{e.loading=!1,e.products.unshift(a.payload)}).addCase(y.rejected,(e,a)=>{e.loading=!1,e.error=a.payload}).addCase(C.pending,e=>{e.loading=!0,e.error=null}).addCase(C.fulfilled,(e,a)=>{if(e.loading=!1,a.payload&&a.payload.product){const d=a.payload.product,r=e.products.findIndex(s=>s.id===d.id);r!==-1&&(e.products[r]=d),e.product=d;const o=e.featuredProducts.findIndex(s=>s.id===d.id);o!==-1&&(e.featuredProducts[o]=d),e.currentProduct=d}}).addCase(C.rejected,(e,a)=>{e.loading=!1,e.error=a.payload}).addCase(h.pending,e=>{e.loading=!0,e.error=null}).addCase(h.fulfilled,(e,a)=>{e.loading=!1,e.products=e.products.filter(d=>d.id!==a.payload)}).addCase(P.pending,e=>{e.loading=!0,e.error=null}).addCase(P.fulfilled,(e,a)=>{e.loading=!1,e.currentProduct=a.payload}).addCase(P.rejected,(e,a)=>{e.loading=!1,e.error=a.payload}).addCase(h.rejected,(e,a)=>{e.loading=!1,e.error=a.payload}).addCase(S.pending,e=>{e.uploadStatus.loading=!0,e.uploadStatus.error=null,e.uploadStatus.success=!1}).addCase(S.fulfilled,e=>{e.uploadStatus.loading=!1,e.uploadStatus.success=!0}).addCase(S.rejected,(e,a)=>{e.uploadStatus.loading=!1,e.uploadStatus.error=a.payload}).addCase($.pending,e=>{e.uploadStatus.loading=!0,e.uploadStatus.error=null,e.uploadStatus.success=!1}).addCase($.fulfilled,e=>{e.uploadStatus.loading=!1,e.uploadStatus.success=!0}).addCase($.rejected,(e,a)=>{e.uploadStatus.loading=!1,e.uploadStatus.error=a.payload})}}),{resetProductDetails:k,clearProductErrors:A}=x.actions,v=x.reducer;export{A as clearProductErrors,y as createProduct,P as createProductTextData,v as default,h as deleteProduct,f as getFeaturedProducts,m as getProductDetails,g as getProducts,k as resetProductDetails,C as updateProduct,S as uploadProductImage,$ as uploadProductImages};
