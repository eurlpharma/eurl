import{bj as l,bk as c,bl as p}from"./index-d1e9d783.js";let o=[];try{o=localStorage.getItem("cartItems")?JSON.parse(localStorage.getItem("cartItems")||"[]"):[],Array.isArray(o)||(o=[])}catch{localStorage.removeItem("cartItems"),o=[]}const g={items:o,loading:!1,error:null,shippingAddress:localStorage.getItem("shippingAddress")?JSON.parse(localStorage.getItem("shippingAddress")||"{}"):null,paymentMethod:localStorage.getItem("paymentMethod")||null},n=l("cart/addToCart",async({productId:t,quantity:e},{rejectWithValue:r})=>{var i,s;try{const a=await c.get(`/api/products/${t}`),d=a.data.success&&a.data.product?a.data.product:a.data;return!d||!d.id?r("Invalid product data received from server"):d.countInStock<e?r("Not enough stock available"):{id:d.id,product:d.id,name:d.name,image:d.images&&d.images.length>0?d.images[0]:d.image,price:d.price,quantity:e}}catch(a){const d=((s=(i=a.response)==null?void 0:i.data)==null?void 0:s.message)||a.message||"Failed to add item to cart";return r(d)}}),m=p({name:"cart",initialState:g,reducers:{addCartItem:(t,e)=>{const r=e.payload,i=t.items.find(s=>s.id===r.id);i?t.items=t.items.map(s=>s.id===i.id?r:s):t.items.push(r),localStorage.setItem("cartItems",JSON.stringify(t.items))},updateCartQuantity:(t,e)=>{const{id:r,quantity:i}=e.payload,s=t.items.find(a=>a.id===r);s&&(s.quantity=i,localStorage.setItem("cartItems",JSON.stringify(t.items)))},removeFromCart:(t,e)=>{t.items=t.items.filter(r=>r.id!==e.payload),localStorage.setItem("cartItems",JSON.stringify(t.items))},clearCart:t=>{t.items=[],localStorage.removeItem("cartItems")},saveShippingAddress:(t,e)=>{t.shippingAddress=e.payload,localStorage.setItem("shippingAddress",JSON.stringify(e.payload))},savePaymentMethod:(t,e)=>{t.paymentMethod=e.payload,localStorage.setItem("paymentMethod",e.payload)},clearShippingAndPayment:t=>{t.shippingAddress=null,t.paymentMethod=null,localStorage.removeItem("shippingAddress"),localStorage.removeItem("paymentMethod")}},extraReducers:t=>{t.addCase(n.pending,e=>{e.loading=!0,e.error=null}).addCase(n.fulfilled,(e,r)=>{e.loading=!1,e.error=null;const i=r.payload;if(!i||typeof i!="object"||!i.id){e.error="Invalid item data";return}const s=e.items.find(a=>a.id===i.id);s?e.items=e.items.map(a=>a.id===s.id?{...a,quantity:a.quantity+i.quantity}:a):e.items.push(i),localStorage.setItem("cartItems",JSON.stringify(e.items))}).addCase(n.rejected,(e,r)=>{e.loading=!1,e.error=r.payload})}}),{addCartItem:I,updateCartQuantity:S,removeFromCart:f,clearCart:h,saveShippingAddress:v,savePaymentMethod:A,clearShippingAndPayment:C}=m.actions,M=m.reducer;export{I as addCartItem,n as addToCart,h as clearCart,C as clearShippingAndPayment,M as default,f as removeFromCart,A as savePaymentMethod,v as saveShippingAddress,S as updateCartQuantity};
