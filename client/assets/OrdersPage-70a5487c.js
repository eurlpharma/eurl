import{F as pe,r as n,G as xe,j as e,B as u,T as h,Z as k,a8 as E,a2 as H,U as g,P as je,V as K,W as Q,X,Y as o,Q as ge,I as C,aK as fe,b1 as ye,b2 as Y,b3 as ve}from"./index-d1e9d783.js";import{u as be}from"./useNotification-a88ee381.js";import{updateDashboardAfterOrderChange as Ce}from"./adminSlice-3ab4ab19.js";import{updateOrderStatus as Ie}from"./orderSlice-072923af.js";import{I as Se}from"./InputAdornment-06a64392.js";import{M as Pe}from"./MagnifyingGlassIcon-2b85ffcf.js";import{F as Te}from"./FunnelIcon-42454335.js";import{T as we,a as De,b as Ne,c as Z,d as r,e as Oe}from"./TableRow-af3e354d.js";import{C as B}from"./Chip-d0686d0b.js";import{E as _e}from"./EyeIcon-1bf2a3b0.js";import{P as ke,E as Ee}from"./PrinterIcon-46f0c926.js";import{T as Be}from"./TrashIcon-f581e95b.js";import{P as Fe}from"./Pagination-a3142cf8.js";import{D as Ae,a as Me,b as Le,c as Ue}from"./DialogTitle-85b1fe0b.js";import{D as We}from"./DialogContentText-cadfe350.js";import"./LastPage-863d5f50.js";const $e=t=>t.slice(-6).toUpperCase(),Re=t=>{switch(t){case"pending":return"warning";case"processing":return"info";case"shipped":return"primary";case"delivered":return"success";case"cancelled":return"error";default:return"default"}},is=()=>{const{t}=pe(),{success:q,error:F}=be(),[I,S]=n.useState([]),[J,A]=n.useState(!0),[M,L]=n.useState(null),[P,T]=n.useState(1),[ee,se]=n.useState(1),[ze,te]=n.useState(0),[U,re]=n.useState(""),[w,ae]=n.useState(""),[f,ne]=n.useState("all"),[W,$]=n.useState(null),[c,R]=n.useState(null),[ie,D]=n.useState(!1),[z,N]=n.useState(null),[y,le]=n.useState(null),m=xe(),oe=s=>{const a=s.target.value;re(a),y&&clearTimeout(y);const i=setTimeout(()=>{T(1),p()},800);le(i)},p=async()=>{var s,a;try{A(!0),L(null);const i=await ye({search:U,page:P,limit:10,status:w||void 0,isPaid:f==="all"?void 0:f==="paid"});S(i.orders),se(i.pages),te(i.total)}catch(i){L(((a=(s=i.response)==null?void 0:s.data)==null?void 0:a.message)||i.message||t("orders.loadError")),S([])}finally{A(!1)}};n.useEffect(()=>(p(),()=>{y&&clearTimeout(y)}),[P,w,f]);const ce=(s,a)=>{$(s.currentTarget),R(a)},O=()=>{$(null),R(null)},v=async(s,a)=>{try{await m(Ie({id:s,statusData:{status:a}}));const x=I.map(d=>d._id===s?{...d,status:a,isPaid:a==="delivered"}:d);m({type:"orders/setOrders",payload:x}),S(x);const j=I.find(d=>d._id===s);j&&m(Ce({isPaid:a==="delivered",totalPrice:j.totalPrice,isNewOrder:!1})),m(Y({message:t("orders.statusUpdated"),type:"success"})),O(),p()}catch(i){m(Y({message:i.message||t("common.errorOccurred"),type:"error"}))}},de=async s=>{try{window.open(`/admin/orders/${s}/print`,"_blank")}catch(a){F(a.message||t("orders.printError"))}},ue=()=>{T(1),p()},he=s=>{N(s),D(!0),O()},me=async()=>{if(z)try{await ve(z),q(t("orders.deleteSuccess")),p()}catch(s){F(s.message||t("orders.deleteError"))}finally{D(!1),N(null)}},G=()=>{D(!1),N(null)};return J?e.jsx(u,{className:"flex justify-center items-center h-64",children:e.jsx(h,{children:t("common.loading")})}):M?e.jsx(u,{className:"flex justify-center items-center h-64",children:e.jsx(h,{color:"error",children:M})}):e.jsxs(u,{className:"p-4",children:[e.jsxs(u,{className:"flex justify-between items-center mb-4",children:[e.jsx(h,{variant:"h5",component:"h1",children:t("orders.title")}),e.jsx(k,{variant:"contained",color:"primary",component:E,to:"/admin/orders/new",children:t("orders.createNew")})]}),e.jsx(H,{className:"p-4 mb-4",children:e.jsxs(g,{container:!0,spacing:2,alignItems:"center",children:[e.jsx(g,{item:!0,xs:12,md:3,children:e.jsx(je,{fullWidth:!0,variant:"outlined",placeholder:t("orders.searchPlaceholder"),value:U,onChange:oe,InputProps:{startAdornment:e.jsx(Se,{position:"start",children:e.jsx(Pe,{className:"w-5 h-5"})})}})}),e.jsx(g,{item:!0,xs:12,md:3,children:e.jsxs(K,{fullWidth:!0,variant:"outlined",children:[e.jsx(Q,{children:t("orders.filterByStatus")}),e.jsxs(X,{value:w,onChange:s=>ae(s.target.value),label:t("orders.filterByStatus"),children:[e.jsx(o,{value:"",children:t("common.all")}),["pending","processing","shipped","delivered","cancelled"].map(s=>e.jsx(o,{value:s,children:t(`orders.status.${s}`)},s))]})]})}),e.jsx(g,{item:!0,xs:12,md:3,children:e.jsxs(K,{fullWidth:!0,variant:"outlined",children:[e.jsx(Q,{children:t("orders.filterByPayment")||"Payment Status"}),e.jsxs(X,{value:f,onChange:s=>ne(s.target.value),label:t("orders.filterByPayment")||"Payment Status",children:[e.jsx(o,{value:"all",children:t("common.all")}),e.jsx(o,{value:"paid",children:t("orders.paid")||"Paid"}),e.jsx(o,{value:"unpaid",children:t("orders.unpaid")||"Unpaid"})]})]})}),e.jsx(g,{item:!0,xs:12,md:3,children:e.jsx(ge,{fullWidth:!0,variant:"outlined",className:"py-3.5",radius:"lg",startContent:e.jsx(Te,{className:"w-5 h-5"}),onClick:ue,children:t("common.filter")})})]})}),e.jsx(we,{component:H,children:e.jsxs(De,{children:[e.jsx(Ne,{children:e.jsxs(Z,{children:[e.jsx(r,{children:t("orders.id")}),e.jsx(r,{children:t("orders.customerInfo")}),e.jsx(r,{children:t("orders.phone")}),e.jsx(r,{children:t("orders.orderDate")}),e.jsx(r,{children:t("orders.totalAmount")}),e.jsx(r,{children:t("orders.paidStatus")||"Paid"}),e.jsx(r,{children:t("orders.titleStatus")}),e.jsx(r,{children:t("orders.products")||"Products"}),e.jsx(r,{align:"right",children:t("common.actions")})]})}),e.jsx(Oe,{children:I.map((s,a)=>{var i,x,j,d,b,V;return e.jsxs(Z,{children:[e.jsx(r,{children:s._id||s.id?e.jsxs(E,{to:`/admin/orders/${s._id||s.id}`,className:"text-primary-600 hover:underline",children:["#",$e(s._id||s.id||"")]}):e.jsx("span",{children:"-"})}),e.jsx(r,{children:e.jsx(u,{children:e.jsx(h,{variant:"body2",className:"font-medium",children:((i=s.guestInfo)==null?void 0:i.name)||(typeof s.user=="object"&&((x=s.user)!=null&&x.name)?s.user.name:"-")})})}),e.jsx(r,{children:e.jsx(h,{variant:"body2",children:((j=s.guestInfo)==null?void 0:j.phone)||(typeof s.user=="object"&&((d=s.user)!=null&&d.phone)?s.user.phone:"-")})}),e.jsx(r,{children:s.createdAt?new Date(s.createdAt).toLocaleDateString():"-"}),e.jsxs(r,{children:[s.totalPrice.toFixed(2)," DA"]}),e.jsx(r,{children:s.isPaid?e.jsx(B,{label:t("orders.paid")||"Paid",color:"success",size:"small"}):e.jsx(B,{label:t("orders.unpaid")||"Unpaid",color:"error",size:"small"})}),e.jsx(r,{children:e.jsx(B,{label:t(`orders.status.${(V=(b=s.status)==null?void 0:b.toLowerCase)==null?void 0:V.call(b)}`),color:Re(s.status),size:"small",variant:"outlined",className:"flex items-center w-fit",classes:{label:"uppercase text-[10px]"}})}),e.jsxs(r,{children:[e.jsx(u,{display:"flex",alignItems:"center",children:s.orderItems&&s.orderItems.length>0?s.orderItems.slice(0,2).map((l,_)=>e.jsx("img",{src:l.image||l.product&&l.product.image||"/images/product-placeholder.svg",alt:l.name,style:{width:32,height:32,objectFit:"cover",marginRight:4,borderRadius:4}},l._id||l.productId||_)):e.jsx("span",{children:"-"})}),e.jsxs(u,{children:[s.orderItems&&s.orderItems.length>0?s.orderItems.slice(0,2).map((l,_)=>e.jsx(h,{variant:"caption",display:"block",children:l.name},l._id||l.productId||_)):e.jsx("span",{children:"-"}),s.orderItems&&s.orderItems.length>2&&e.jsxs(h,{variant:"caption",color:"textSecondary",children:["+",s.orderItems.length-2," more"]})]})]}),e.jsxs(r,{align:"right",children:[e.jsx(C,{component:s._id||s.id?E:"button",to:s._id||s.id?`/admin/orders/${s._id||s.id}`:void 0,color:"primary",title:t("common.view"),disabled:!s._id&&!s.id,children:e.jsx(_e,{className:"w-5 h-5"})}),e.jsx(C,{onClick:()=>de(s._id||s.id||""),color:"secondary",title:t("orders.printInvoice"),children:e.jsx(ke,{className:"w-5 h-5"})}),e.jsx(C,{onClick:()=>he(s._id||s.id||""),color:"error",title:t("common.delete"),children:e.jsx(Be,{className:"w-5 h-5"})}),e.jsx(C,{onClick:l=>ce(l,s._id||s.id||""),title:t("common.actions"),children:e.jsx(Ee,{className:"w-5 h-5"})})]})]},s._id||s.id||a)})})]})}),e.jsx(u,{className:"flex justify-center mt-4",children:e.jsx(Fe,{count:ee,page:P,onChange:(s,a)=>T(a),color:"primary",showFirstButton:!0,showLastButton:!0})}),e.jsxs(Ae,{open:ie,onClose:G,"aria-labelledby":"delete-dialog-title","aria-describedby":"delete-dialog-description",children:[e.jsx(Me,{id:"delete-dialog-title",children:t("orders.deleteConfirmTitle")}),e.jsx(Le,{children:e.jsx(We,{id:"delete-dialog-description",children:t("orders.deleteConfirmMessage")})}),e.jsxs(Ue,{children:[e.jsx(k,{onClick:G,color:"primary",children:t("common.cancel")}),e.jsx(k,{onClick:me,color:"error",variant:"contained",children:t("common.delete")})]})]}),e.jsxs(fe,{anchorEl:W,open:!!W,onClose:O,children:[e.jsx(o,{onClick:()=>c&&v(c,"processing"),children:t("orders.status.processing")}),e.jsx(o,{onClick:()=>c&&v(c,"shipped"),children:t("orders.status.shipped")}),e.jsx(o,{onClick:()=>c&&v(c,"delivered"),children:t("orders.status.delivered")}),e.jsx(o,{onClick:()=>c&&v(c,"cancelled"),children:t("orders.status.cancelled")})]})]})};export{is as default};
