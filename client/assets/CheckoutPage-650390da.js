import{F as X,N as B,r as j,aa as P,ab as D,j as e,B as b,T as t,U as f,P as O,V,W as G,X as M,Y as R,ac as U,ad as Q,ae as Z,b as W,a2 as F,af as ee,ag as _,ah as q,a1 as z,G as ae,u as ie,C as de,ai as ne,aj as se}from"./index-d1e9d783.js";import{resetOrderSuccess as re,createOrder as me}from"./orderSlice-072923af.js";import{clearCart as te}from"./cartSlice-0c1f42b2.js";import{u as oe}from"./useNotification-a88ee381.js";import{c as ce,a as v,u as le,o as ue}from"./index.esm-590aa197.js";import{B as he}from"./Breadcrumb-15b3a31b.js";import{S as pe,a as xe,b as ye}from"./Stepper-2cad4e76.js";import"./FloatingLeaf-437cd19f.js";const fe=({onSubmit:u,initialData:m})=>{var C,T,A;const{t:a}=X(),{user:p}=B(d=>d.auth),[g,h]=j.useState([]),N=ce().shape({fullName:v().required(a("validation.required")),phone:v().required(a("validation.required")),wilaya:v().required(a("validation.required")),daira:v().required(a("validation.required")),address:v()}),{register:l,handleSubmit:s,watch:o,setValue:r,formState:{errors:n}}=le({resolver:ue(N),defaultValues:m||{fullName:(p==null?void 0:p.name)||"",phone:"",wilaya:"",daira:"",address:"",postalCode:"",deliveryType:"office"}}),x=o("wilaya"),c=o("daira"),w=o("deliveryType");j.useEffect(()=>{if(x){const d=P.filter(i=>i.wilaya_id===x);h(d),r("daira",""),r("postalCode","")}},[x,r]),j.useEffect(()=>{if(c){const d=P.find(i=>i.id===c);d&&(r("postalCode",d.post_code),r("dairaName",D.language.startsWith("ar")?d.ar_name:d.name))}},[c,r]),j.useEffect(()=>{w||r("deliveryType","office")},[w,r]);const k=Array.from(P.reduce((d,i)=>(d.has(i.wilaya_id)||d.set(i.wilaya_id,{wilaya_id:i.wilaya_id,name:i.name,ar_name:i.ar_name}),d),new Map).values()),S=d=>D.language.startsWith("ar")?d.ar_name:d.name;return e.jsxs(b,{component:"form",onSubmit:s(u),noValidate:!0,children:[e.jsx(t,{variant:"h6",gutterBottom:!0,children:a("checkout.shippingAddress")}),e.jsxs(f,{container:!0,spacing:3,children:[e.jsx(f,{item:!0,xs:12,children:e.jsx(O,{fullWidth:!0,autoComplete:"off",label:a("checkout.fullName"),...l("fullName"),error:!!n.fullName,helperText:(C=n.fullName)==null?void 0:C.message})}),e.jsx(f,{item:!0,xs:12,children:e.jsx(O,{fullWidth:!0,autoComplete:"off",label:a("checkout.phone"),...l("phone"),error:!!n.phone,helperText:(T=n.phone)==null?void 0:T.message,placeholder:"0XXXXXXXXX",dir:"ltr"})}),e.jsx(f,{item:!0,xs:12,sm:6,children:e.jsxs(V,{fullWidth:!0,error:!!n.wilaya,children:[e.jsx(G,{id:"wilaya-label",children:a("checkout.wilaya")}),e.jsx(M,{labelId:"wilaya-label",label:a("checkout.wilaya"),...l("wilaya"),children:k.map(d=>e.jsx(R,{value:d.wilaya_id,children:`${d.wilaya_id} - ${S(d)}`},d.wilaya_id))}),n.wilaya&&e.jsx(U,{children:n.wilaya.message})]})}),e.jsx(f,{item:!0,xs:12,sm:6,children:e.jsxs(V,{fullWidth:!0,error:!!n.daira,disabled:!x,children:[e.jsx(G,{id:"daira-label",children:a("checkout.daira")}),e.jsx(M,{labelId:"daira-label",label:a("checkout.daira"),...l("daira"),children:g.map(d=>e.jsx(R,{value:d.id,children:D.language.startsWith("ar")?d.ar_name:d.name},d.id))}),n.daira&&e.jsx(U,{children:n.daira.message})]})}),e.jsx(f,{item:!0,xs:12,children:e.jsx(O,{fullWidth:!0,autoComplete:"off",label:a("checkout.address"),...l("address"),error:!!n.address,helperText:(A=n.address)==null?void 0:A.message,placeholder:a("checkout.addressOptional")})}),e.jsxs(f,{item:!0,xs:12,children:[e.jsx(t,{variant:"subtitle1",className:"mb-2 font-josefin",children:a("checkout.deliveryType")||"نوع التوصيل"}),e.jsxs(b,{display:"flex",gap:2,mt:1,children:[e.jsxs("button",{type:"button",className:`flex-1 flex flex-col items-center justify-center p-4 rounded-lg border transition shadow-sm ${w==="home"?"border-girl-secondary bg-girl-secondary/10":"border-gray-300 bg-white"}`,onClick:()=>r("deliveryType","home"),children:[e.jsx(Q,{className:"w-8 h-8"}),e.jsx("span",{className:"mt-2 font-medium text-base",children:a("checkout.deliveryHome")||"توصيل للمنزل"})]}),e.jsxs("button",{type:"button",className:`flex-1 flex flex-col items-center justify-center p-4 rounded-lg border transition shadow-sm ${w==="office"?"border-girl-secondary bg-girl-secondary/10":"border-gray-300 bg-white"}`,onClick:()=>r("deliveryType","office"),children:[e.jsx(Z,{className:"w-8 h-8"}),e.jsx("span",{className:"mt-2 font-medium text-base",children:a("checkout.deliveryOffice")||"توصيل للمكتب"})]})]}),e.jsx("input",{type:"hidden",...l("deliveryType")})]})]}),e.jsx(b,{className:"mt-6 flex justify-end",children:e.jsx("button",{type:"submit",color:"primary",className:W(" px-5 py-2 flex items-center gap-1"," font-josefin text-girl-white","bg-girl-secondary cursor-pointer"),children:a("checkout.continue")})})]})},Y=[{id:1,name:"أدرار",dairas:[{id:1,name:"أدرار"},{id:2,name:"أولف"},{id:3,name:"رقان"},{id:4,name:"تيميمون"},{id:5,name:"تينركوك"},{id:6,name:"شروين"}]},{id:2,name:"الشلف",dairas:[{id:1,name:"الشلف"},{id:2,name:"تنس"},{id:3,name:"واد الفضة"},{id:4,name:"أبو الحسن"},{id:5,name:"المرسى"}]},{id:3,name:"الأغواط",dairas:[{id:1,name:"الأغواط"},{id:2,name:"آفلو"},{id:3,name:"قلتة سيدي سعد"},{id:4,name:"حاسي الرمل"}]},{id:4,name:"أم البواقي",dairas:[{id:1,name:"أم البواقي"},{id:2,name:"عين البيضاء"},{id:3,name:"عين مليلة"},{id:4,name:"سوق نعمان"}]},{id:5,name:"باتنة",dairas:[{id:1,name:"باتنة"},{id:2,name:"بريكة"},{id:3,name:"عين التوتة"},{id:4,name:"آريس"},{id:5,name:"نقاوس"}]},{id:6,name:"بجاية",dairas:[{id:1,name:"بجاية"},{id:2,name:"أقبو"},{id:3,name:"صدوق"},{id:4,name:"تيشي"}]},{id:7,name:"بسكرة",dairas:[{id:1,name:"بسكرة"},{id:2,name:"أولاد جلال"},{id:3,name:"سيدي عقبة"},{id:4,name:"طولقة"}]},{id:8,name:"بشار",dairas:[{id:1,name:"بشار"},{id:2,name:"العبادلة"},{id:3,name:"بني ونيف"},{id:4,name:"تاغيت"}]},{id:9,name:"البليدة",dairas:[{id:1,name:"البليدة"},{id:2,name:"بوفاريك"},{id:3,name:"موزاية"},{id:4,name:"الأربعاء"}]},{id:10,name:"البويرة",dairas:[{id:1,name:"البويرة"},{id:2,name:"عين بسام"},{id:3,name:"سور الغزلان"},{id:4,name:"مشدالله"}]},{id:11,name:"تمنراست",dairas:[{id:1,name:"تمنراست"},{id:2,name:"عين صالح"},{id:3,name:"عين قزام"}]},{id:12,name:"تبسة",dairas:[{id:1,name:"تبسة"},{id:2,name:"الشريعة"},{id:3,name:"بئر العاتر"},{id:4,name:"الونزة"}]},{id:13,name:"تلمسان",dairas:[{id:1,name:"تلمسان"},{id:2,name:"مغنية"},{id:3,name:"الرمشي"},{id:4,name:"سبدو"}]},{id:14,name:"تيارت",dairas:[{id:1,name:"تيارت"},{id:2,name:"فرندة"},{id:3,name:"عين الذهب"},{id:4,name:"قصر الشلالة"}]},{id:15,name:"تيزي وزو",dairas:[{id:1,name:"تيزي وزو"},{id:2,name:"عزازقة"},{id:3,name:"عين الحمام"},{id:4,name:"بوغني"}]},{id:16,name:"الجزائر",dairas:[{id:1,name:"باب الوادي"},{id:2,name:"الحراش"},{id:3,name:"بئر مراد رايس"},{id:4,name:"حسين داي"},{id:5,name:"براقي"},{id:6,name:"الدار البيضاء"}]},{id:17,name:"الجلفة",dairas:[{id:1,name:"الجلفة"},{id:2,name:"مسعد"},{id:3,name:"حاسي بحبح"},{id:4,name:"عين وسارة"}]},{id:18,name:"جيجل",dairas:[{id:1,name:"جيجل"},{id:2,name:"الميلية"},{id:3,name:"الطاهير"},{id:4,name:"زيامة منصورية"}]},{id:19,name:"سطيف",dairas:[{id:1,name:"سطيف"},{id:2,name:"العلمة"},{id:3,name:"عين ولمان"},{id:4,name:"بوقاعة"}]},{id:20,name:"سعيدة",dairas:[{id:1,name:"سعيدة"},{id:2,name:"الحساسنة"},{id:3,name:"سيدي بوبكر"},{id:4,name:"يوب"}]},{id:21,name:"سكيكدة",dairas:[{id:1,name:"سكيكدة"},{id:2,name:"القل"},{id:3,name:"عزابة"},{id:4,name:"تمالوس"}]},{id:22,name:"سيدي بلعباس",dairas:[{id:1,name:"سيدي بلعباس"},{id:2,name:"تلاغ"},{id:3,name:"سفيزف"},{id:4,name:"مرحوم"}]},{id:23,name:"عنابة",dairas:[{id:1,name:"عنابة"},{id:2,name:"برحال"},{id:3,name:"الحجار"},{id:4,name:"عين الباردة"}]},{id:24,name:"قالمة",dairas:[{id:1,name:"قالمة"},{id:2,name:"واد الزناتي"},{id:3,name:"بوشقوف"},{id:4,name:"سوق أهراس"}]},{id:25,name:"قسنطينة",dairas:[{id:1,name:"قسنطينة"},{id:2,name:"الخروب"},{id:3,name:"حامة بوزيان"},{id:4,name:"زيغود يوسف"}]},{id:26,name:"المدية",dairas:[{id:1,name:"المدية"},{id:2,name:"قصر البخاري"},{id:3,name:"عين بوسيف"},{id:4,name:"البرواقية"}]},{id:27,name:"مستغانم",dairas:[{id:1,name:"مستغانم"},{id:2,name:"عين تادلس"},{id:3,name:"عشعاشة"},{id:4,name:"سيدي علي"}]},{id:28,name:"المسيلة",dairas:[{id:1,name:"المسيلة"},{id:2,name:"بوسعادة"},{id:3,name:"سيدي عيسى"},{id:4,name:"عين الملح"}]},{id:29,name:"معسكر",dairas:[{id:1,name:"معسكر"},{id:2,name:"سيق"},{id:3,name:"تيغنيف"},{id:4,name:"المحمدية"}]},{id:30,name:"ورقلة",dairas:[{id:1,name:"ورقلة"},{id:2,name:"حاسي مسعود"},{id:3,name:"تقرت"},{id:4,name:"الطيبات"}]},{id:31,name:"وهران",dairas:[{id:1,name:"وهران"},{id:2,name:"عين الترك"},{id:3,name:"السانية"},{id:4,name:"أرزيو"},{id:5,name:"بطيوة"}]},{id:32,name:"البيض",dairas:[{id:1,name:"البيض"},{id:2,name:"بريزينة"},{id:3,name:"الأبيض سيد الشيخ"},{id:4,name:"بوعلام"}]},{id:33,name:"إليزي",dairas:[{id:1,name:"إليزي"},{id:2,name:"جانت"},{id:3,name:"دبداب"},{id:4,name:"برج عمر إدريس"}]},{id:34,name:"برج بوعريريج",dairas:[{id:1,name:"برج بوعريريج"},{id:2,name:"رأس الوادي"},{id:3,name:"برج الغدير"},{id:4,name:"المنصورة"}]},{id:35,name:"بومرداس",dairas:[{id:1,name:"بومرداس"},{id:2,name:"برج منايل"},{id:3,name:"دلس"},{id:4,name:"بودواو"}]},{id:36,name:"الطارف",dairas:[{id:1,name:"الطارف"},{id:2,name:"بن مهيدي"},{id:3,name:"القالة"},{id:4,name:"بوحجار"}]},{id:37,name:"تندوف",dairas:[{id:1,name:"تندوف"},{id:2,name:"أم العسل"}]},{id:38,name:"تيسمسيلت",dairas:[{id:1,name:"تيسمسيلت"},{id:2,name:"ثنية الحد"},{id:3,name:"برج بونعامة"},{id:4,name:"عماري"}]},{id:39,name:"الوادي",dairas:[{id:1,name:"الوادي"},{id:2,name:"المغير"},{id:3,name:"جامعة"},{id:4,name:"الرباح"}]},{id:40,name:"خنشلة",dairas:[{id:1,name:"خنشلة"},{id:2,name:"قايس"},{id:3,name:"أولاد رشاش"},{id:4,name:"بوحمامة"}]},{id:41,name:"سوق أهراس",dairas:[{id:1,name:"سوق أهراس"},{id:2,name:"سدراتة"},{id:3,name:"مداوروش"},{id:4,name:"تاورة"}]},{id:42,name:"تيبازة",dairas:[{id:1,name:"تيبازة"},{id:2,name:"شرشال"},{id:3,name:"القليعة"},{id:4,name:"حجوط"}]},{id:43,name:"ميلة",dairas:[{id:1,name:"ميلة"},{id:2,name:"فرجيوة"},{id:3,name:"شلغوم العيد"},{id:4,name:"واد العثمانية"}]},{id:44,name:"عين الدفلى",dairas:[{id:1,name:"عين الدفلى"},{id:2,name:"خميس مليانة"},{id:3,name:"مليانة"},{id:4,name:"العطاف"}]},{id:45,name:"النعامة",dairas:[{id:1,name:"النعامة"},{id:2,name:"عين الصفراء"},{id:3,name:"مشرية"},{id:4,name:"مغرار"}]},{id:46,name:"عين تموشنت",dairas:[{id:1,name:"عين تموشنت"},{id:2,name:"حمام بوحجر"},{id:3,name:"العامرية"},{id:4,name:"بني صاف"}]},{id:47,name:"غرداية",dairas:[{id:1,name:"غرداية"},{id:2,name:"المنيعة"},{id:3,name:"بريان"},{id:4,name:"متليلي"}]},{id:48,name:"غليزان",dairas:[{id:1,name:"غليزان"},{id:2,name:"وادي رهيو"},{id:3,name:"مازونة"},{id:4,name:"عين طارق"}]},{id:49,name:"تيميمون",dairas:[{id:1,name:"تيميمون"},{id:2,name:"أولاد سعيد"},{id:3,name:"شروين"}]},{id:50,name:"برج باجي مختار",dairas:[{id:1,name:"برج باجي مختار"},{id:2,name:"تيمياوين"}]},{id:51,name:"أولاد جلال",dairas:[{id:1,name:"أولاد جلال"},{id:2,name:"سيدي خالد"}]},{id:52,name:"بني عباس",dairas:[{id:1,name:"بني عباس"},{id:2,name:"كرزاز"},{id:3,name:"إقلي"}]},{id:53,name:"عين صالح",dairas:[{id:1,name:"عين صالح"},{id:2,name:"فقارة الزوى"}]},{id:54,name:"عين قزام",dairas:[{id:1,name:"عين قزام"},{id:2,name:"تين زواتين"}]},{id:55,name:"تقرت",dairas:[{id:1,name:"تقرت"},{id:2,name:"تماسين"},{id:3,name:"الطيبات"}]},{id:56,name:"جانت",dairas:[{id:1,name:"جانت"},{id:2,name:"برج الحواس"}]},{id:57,name:"المغير",dairas:[{id:1,name:"المغير"},{id:2,name:"جامعة"}]},{id:58,name:"المنيعة",dairas:[{id:1,name:"المنيعة"},{id:2,name:"حاسي الفحل"}]}],je=({shippingData:u,cartItems:m})=>{const{t:a}=X(),p=m&&m.length>0?m.reduce((s,o)=>s+o.price*o.quantity,0):0,g=500,h=Number((p+g).toFixed(2)),N=s=>{const o=Y.find(r=>r.id===parseInt(s));return o?o.name:s},l=(s,o)=>{const r=Y.find(x=>x.id===parseInt(s));if(!r)return o;const n=r.dairas.find(x=>x.id===parseInt(o));return n?n.name:o};return e.jsxs(b,{children:[e.jsx(t,{variant:"h6",gutterBottom:!0,className:"font-josefin",children:a("checkout.orderSummary")}),e.jsxs(f,{container:!0,spacing:4,children:[e.jsxs(f,{item:!0,xs:12,md:6,children:[e.jsxs(F,{className:"p-4 shadow-sm rounded-none",children:[e.jsx(t,{variant:"h6",gutterBottom:!0,className:"font-josefin",children:a("checkout.shippingAddress")}),e.jsx(t,{gutterBottom:!0,children:u.fullName}),e.jsx(t,{gutterBottom:!0,children:u.phone}),e.jsxs(t,{gutterBottom:!0,children:[N(u.wilaya),", ",l(u.wilaya,u.daira)]}),e.jsxs(t,{gutterBottom:!0,children:[a("checkout.deliveryType"),": ",u.deliveryType==="home"?a("checkout.deliveryHome"):a("checkout.deliveryOffice")]}),u.address&&e.jsx(t,{gutterBottom:!0,children:u.address})]}),e.jsxs(F,{className:"p-4 mt-4 shadow-sm rounded-none",children:[e.jsx(t,{variant:"h6",gutterBottom:!0,className:"font-josefin",children:a("checkout.paymentDetails")}),e.jsx(t,{children:a("checkout.cashOnDelivery")}),e.jsx(t,{variant:"body2",color:"textSecondary",className:"mt-2",children:a("checkout.paymentNote")})]})]}),e.jsx(f,{item:!0,xs:12,md:6,children:e.jsxs(F,{className:"p-4 shadow-sm rounded-none",children:[e.jsxs(t,{variant:"h6",gutterBottom:!0,className:"font-josefin",children:[a("checkout.orderItems")," (",m?m.length:0,")"]}),e.jsxs(ee,{disablePadding:!0,children:[m&&m.length>0&&m.map(s=>e.jsxs(_,{className:"py-2",children:[e.jsx(b,{className:"w-16 h-16 mr-4",children:e.jsx("img",{src:s.image,alt:s.name,className:"w-full h-full object-cover rounded"})}),e.jsx(q,{primary:s.name,secondary:`${a("product.quantity")}: ${s.quantity}`}),e.jsxs(t,{variant:"body2",children:["DA ",(s.price*s.quantity).toFixed(2)]})]},s.product)),e.jsx(z,{className:"my-2"}),e.jsxs(_,{className:"py-2",children:[e.jsx(q,{primary:a("checkout.subtotal")}),e.jsxs(t,{variant:"body1",children:["DA ",p.toFixed(2)," DA"]})]}),e.jsxs(_,{className:"py-2",children:[e.jsx(q,{primary:a("checkout.shipping")}),e.jsxs(t,{variant:"body1",children:["DA ",g.toFixed(2)," DA"]})]}),e.jsx(z,{className:"my-2"}),e.jsxs(_,{className:"py-2",children:[e.jsx(q,{primary:a("checkout.total")}),e.jsxs(t,{variant:"h6",className:"font-semibold",children:[h.toFixed(2)," DA"]})]})]})]})})]})]})},J=["shipping","review"],Te=()=>{const{user:u}=B(i=>i.auth),{t:m}=X(),a=ae(),p=ie(),{success:g}=oe(),{items:h,loading:N}=B(i=>i.cart),{loading:l,error:s,success:o,order:r}=B(i=>i.orders),[n,x]=j.useState(0),[c,w]=j.useState({fullName:"",phone:"",wilaya:"",daira:"",address:""}),k="cash_on_delivery";j.useEffect(()=>{o&&r&&(g(m("checkout.orderSuccess")),a(te()),a(re()),p(`/orders/${r._id}`))},[o,r,a,p,g,m]),j.useEffect(()=>{!N&&h&&h.length===0&&p("/cart")},[h,N,p]);const S=()=>{x(i=>i+1)},C=()=>{x(i=>i-1)},T=i=>{w({...i,address:i.address||""}),S()},A=async()=>{var I;const i=Array.isArray(h)?h.reduce((y,H)=>y+H.price*H.quantity,0):0,$=i>100?0:10,E=Number((.15*i).toFixed(2)),K=Number((i+$+E).toFixed(2));let L={orderItems:Array.isArray(h)?h.map(y=>({product:y.product,qty:Number(y.quantity)||1,name:y.name,price:y.price,image:y.image})):[],shippingAddress:{...c,country:c.country||"Algeria",city:c.city||c.wilaya||"",postalCode:c.postalCode&&c.postalCode.trim()!==""?c.postalCode:"16000"},paymentMethod:k,itemsPrice:i,shippingPrice:$,taxPrice:E,totalPrice:K,isGuest:!u};u||(L.guestInfo={name:c.fullName,phone:c.phone,email:c.email||""});try{await a(me(L)).unwrap()}catch(y){throw(I=y.response)==null||I.status,y}},d=i=>{switch(i){case 0:return e.jsx(fe,{onSubmit:T,initialData:c});case 1:return e.jsx(je,{shippingData:c,paymentMethod:k,cartItems:h});default:throw new Error("Unknown step")}};return e.jsxs("div",{children:[e.jsx(he,{pageName:"Checkout"}),e.jsx(de,{maxWidth:"lg",className:"py-8",children:e.jsxs(F,{className:"p-6 shadow-none rounded-none",children:[s&&e.jsx(ne,{severity:"error",className:"mb-4",children:s}),e.jsx(pe,{activeStep:n,className:"mb-8",children:J.map(i=>e.jsx(xe,{children:e.jsx(ye,{children:m(`checkout.${i}`)})},i))}),e.jsxs(b,{children:[d(n),e.jsxs(b,{className:"mt-8 flex justify-between",children:[e.jsx("button",{onClick:C,disabled:n===0||l,className:W("border-girl-secondary border-solid border-1 px-4","text-girl-secondary font-josefin hover:text-girl-white","hover:bg-girl-secondary cursor-pointer"),children:m("checkout.back")}),n===J.length-1?e.jsxs("button",{onClick:A,disabled:l,className:W(" px-5 py-2 flex items-center gap-1"," font-josefin text-girl-white","bg-girl-secondary cursor-pointer"),children:[l&&e.jsx(se,{size:20,color:"inherit"}),m(l?"checkout.processing":"checkout.placeOrder")]}):e.jsx("button",{onClick:S,disabled:l,className:W(" px-5 py-2"," font-josefin text-girl-white","bg-girl-secondary cursor-pointer"),children:m("checkout.next")})]})]})]})})]})};export{Te as default};
