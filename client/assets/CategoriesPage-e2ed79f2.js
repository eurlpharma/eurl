import{F as V,G as X,N as Y,r,j as e,B as d,T as u,Z as m,a2 as Z,I as W,P,V as J,W as K,X as Q,Y as E}from"./index-d1e9d783.js";import{getCategories as O,updateCategory as _,createCategory as ee,deleteCategory as ae}from"./categorySlice-76f8fec3.js";import{u as se}from"./useNotification-a88ee381.js";import{I as te}from"./Image-69590449.js";import{P as ie}from"./PlusIcon-436a5931.js";import{T as ne,a as re,b as oe,c as g,d as i,e as le}from"./TableRow-af3e354d.js";import{P as ce}from"./PencilIcon-564e0e25.js";import{T as de}from"./TrashIcon-f581e95b.js";import{D as B,a as F,b as $,c as R}from"./DialogTitle-85b1fe0b.js";const Ce=()=>{const{t:s}=V(),{success:x,error:w}=se(),o=X(),{categories:j,loading:f,error:h}=Y(a=>a.categories);r.useEffect(()=>{o(O())},[o]);const[L,I]=r.useState(!1),[U,N]=r.useState(!1),[c,v]=r.useState(null),[T,S]=r.useState({}),[n,p]=r.useState({name:"",description:"",isActive:!0,image:null}),[A,l]=r.useState(""),k=(a=null)=>{a?(p({name:a.name,description:a.description||"",isActive:a.isActive,image:null}),v(a),a.image?l(a.image.startsWith("http")?a.image:`https://eurl-server.onrender.com/uploads/categories/${a.image}`):l("")):(p({name:"",description:"",isActive:!0,image:null}),v(null),l("")),S({}),I(!0)},C=()=>{I(!1)},z=a=>{v(a),N(!0)},b=()=>{N(!1)},D=a=>{const{name:t,value:y}=a.target;p({...n,[t]:y})},q=a=>{if(a.target.files&&a.target.files[0]){const t=a.target.files[0];p(y=>({...y,image:t})),l(URL.createObjectURL(t))}},G=()=>{const a={};return n.name.trim()||(a.name=s("validation.required")),S(a),Object.keys(a).length===0},H=async()=>{if(G())try{const a=new FormData;if(a.append("name",n.name),a.append("description",n.description),a.append("isActive",n.isActive.toString()),n.image&&a.append("image",n.image),c){const t=await o(_({id:c.id,categoryData:a})).unwrap();t.image&&l(t.image.startsWith("http")?t.image:`https://eurl-server.onrender.com/uploads/categories/${t.image}`),x(s("admin.categoryUpdated"))}else{const t=await o(ee(a)).unwrap();t.image&&l(t.image.startsWith("http")?t.image:`https://eurl-server.onrender.com/uploads/categories/${t.image}`),x(s("admin.categoryCreated"))}o(O()),C()}catch(a){w((a==null?void 0:a.message)||s("error.general"))}},M=async()=>{if(c)try{await o(ae(c.id)).unwrap(),x(s("admin.categoryDeleted")),b()}catch(a){w((a==null?void 0:a.message)||s("error.general"))}};return e.jsxs(d,{className:"p-4",children:[e.jsxs(d,{className:"flex justify-between items-center mb-6",children:[e.jsx(u,{variant:"h4",component:"h1",className:"font-josefin",children:s("admin.categories")}),e.jsx(m,{variant:"contained",color:"primary",startIcon:e.jsx(ie,{className:"w-5 h-5"}),onClick:()=>k(),children:s("admin.addCategory")})]}),e.jsx(ne,{component:Z,children:e.jsxs(re,{children:[e.jsx(oe,{children:e.jsxs(g,{children:[e.jsx(i,{children:s("categories.image")}),e.jsx(i,{children:s("categories.name")}),e.jsx(i,{children:s("categories.description")}),e.jsx(i,{children:s("categories.status")}),e.jsx(i,{align:"right",children:s("common.actions")})]})}),e.jsxs(le,{children:[f&&e.jsx(g,{children:e.jsx(i,{colSpan:5,align:"center",children:s("loading")})}),h&&e.jsx(g,{children:e.jsx(i,{colSpan:5,align:"center",style:{color:"red"},children:h})}),!f&&!h&&j&&j.length>0?j.map(a=>e.jsxs(g,{children:[e.jsx(i,{children:e.jsx("img",{src:a.image?a.image.startsWith("http")?a.image:`https://eurl-server.onrender.com/uploads/categories/${a.image}`:"/images/placeholder.png",alt:a.name,className:"w-10 h-10 object-cover rounded-full"})}),e.jsx(i,{children:a.name}),e.jsx(i,{children:a.description||"-"}),e.jsx(i,{children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${a.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:a.isActive?s("common.active"):s("common.inactive")})}),e.jsxs(i,{align:"right",children:[e.jsx(W,{color:"primary",onClick:()=>k(a),size:"small",children:e.jsx(ce,{className:"w-5 h-5"})}),e.jsx(W,{color:"error",onClick:()=>z(a),size:"small",children:e.jsx(de,{className:"w-5 h-5"})})]})]},a.id)):!f&&!h&&e.jsx(g,{children:e.jsx(i,{colSpan:5,align:"center",children:s("admin.noCategories")})})]})]})}),e.jsxs(B,{container:document.getElementById("root"),open:L,onClose:C,maxWidth:"sm",fullWidth:!0,children:[e.jsx(F,{children:s(c?"admin.editCategory":"admin.addCategory")}),e.jsx($,{children:e.jsxs(d,{className:"space-y-4 mt-4",children:[e.jsx(P,{fullWidth:!0,label:s("categories.name"),name:"name",value:n.name,onChange:D,error:!!T.name,helperText:T.name}),e.jsx(P,{fullWidth:!0,label:s("categories.description"),name:"description",value:n.description,onChange:D,multiline:!0,rows:3}),e.jsxs(J,{fullWidth:!0,children:[e.jsx(K,{children:s("categories.status")}),e.jsxs(Q,{name:"isActive",value:n.isActive,onChange:a=>D(a),label:s("categories.status"),children:[e.jsx(E,{value:"true",children:s("common.active")}),e.jsx(E,{value:"false",children:s("common.inactive")})]})]}),e.jsxs(d,{children:[e.jsx(u,{variant:"subtitle1",className:"mb-2",children:s("categories.image")}),e.jsxs(d,{className:"border-2 border-dashed border-gray-300 rounded-lg p-4 text-center cursor-pointer hover:border-indigo-500",onClick:()=>{var a;return(a=document.getElementById("image-upload"))==null?void 0:a.click()},children:[A?e.jsx("img",{src:A,alt:"Preview",className:"mx-auto h-32 w-32 object-cover rounded-lg mb-2"}):e.jsx(te,{className:"mx-auto h-12 w-12 text-gray-400 mb-2"}),e.jsx(u,{variant:"body2",color:"text.secondary",children:typeof s("categories.uploadImage")=="string"?s("categories.uploadImage"):"رفع صورة"}),e.jsx("input",{id:"image-upload",type:"file",accept:"image/*",className:"hidden",onChange:q})]})]})]})}),e.jsxs(R,{children:[e.jsx(m,{onClick:C,children:s("common.cancel")}),e.jsx(m,{onClick:H,variant:"contained",color:"primary",children:s("common.save")})]})]}),e.jsxs(B,{open:U,onClose:b,children:[e.jsx(F,{children:s("admin.deleteCategory")}),e.jsx($,{children:e.jsx(u,{children:s("admin.deleteCategoryConfirm")})}),e.jsxs(R,{children:[e.jsx(m,{onClick:b,children:s("common.cancel")}),e.jsx(m,{onClick:M,variant:"contained",color:"error",children:s("common.delete")})]})]})]})};export{Ce as default};
